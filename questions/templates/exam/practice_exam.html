<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pr√°ctica CCNA - Feedback inmediato</title>
  {% load static %}
  <link rel="stylesheet" href="{% static 'questions/css/selection_exam.css' %}">
  <style>
    /* Clases m√≠nimas extra para feedback inmediato */
    .option.correct { border-color: #22c55e; background: rgba(34,197,94,0.08); }
    .option.wrong   { border-color: #ef4444; background: rgba(239,68,68,0.08); }
    .option.locked  { opacity: 0.85; pointer-events: none; }
    .result-badge { margin-top: 10px; font-weight: 600; }
    .result-ok { color: #16a34a; }
    .result-bad { color: #dc2626; }
    .confirm-multi { margin-top: 10px; }
  </style>
</head>
<body>
  <div class="exam-container">
    <a href="{% url 'examen' %}" class="back-btn">‚Üê Volver al Men√∫ Principal</a>

    <div class="header">
      <h1>üß™ Modo Pr√°ctica (Feedback inmediato)</h1>
      <p class="exam-info">Al elegir, ver√°s si es correcto tras ~250 ms.</p>
    </div>

    {% csrf_token %}
    <input type="hidden" id="csrfToken" value="{{ csrf_token }}"/>

    {% if questions %}
      <!-- Marcador en vivo -->
      <div class="progress-wrapper">
        <div class="progress-top">
          <div id="posCard" class="stat-card">
            <div class="stat-number">1</div>
            <div class="stat-label">Pregunta Actual</div>
          </div>
          <div id="liveScore" class="stat-card">
            <div class="stat-number">0 / 0</div>
            <div class="stat-label">Aciertos / Intentadas</div>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="pageProgress" style="width:0%"></div>
        </div>
      </div>

      <!-- Preguntas -->
      {% for q in questions %}
        <fieldset class="question{% if not forloop.first %} hidden{% endif %}{% if forloop.first %} active{% endif %}" 
                  data-index="{{ forloop.counter0 }}"
                  data-qid="{{ q.id }}"
                  data-qtype="{{ q.question_type }}">
          
          {% if q.has_image and q.image_path %}
          <div class="question-image">
            <img src="/media/{{ q.image_path }}" alt="Imagen de la pregunta {{ forloop.counter }}" style="display:none;">
          </div>
          {% endif %}

          <h2 class="question-text" id="question-text">
            {{ q.text|linebreaksbr }}
          </h2>

          {# Un solo bucle para SINGLE y MULTI, usando q.options #}
          {% for letter, content in q.options %}
            {% if content %}
            <div class="option">
              <label>
                <input
                  type="{% if q.question_type == 'SINGLE' %}radio{% else %}checkbox{% endif %}"
                  name="q_{{ q.id }}"
                  value="{{ letter }}"
                >
                <div class="option-text">
                  <span class="option-letter">{{ letter }})</span>
                  <span class="option-content">{{ content|linebreaksbr }}</span>
                </div>
              </label>
            </div>
            {% endif %}
          {% endfor %}

          {% if q.question_type == "MULTI" %}
            <button type="button" class="nav-btn confirm-multi">Confirmar selecci√≥n</button>
          {% endif %}

          <div class="result-badge" aria-live="polite"></div>
        </fieldset>
      {% endfor %}

      <!-- Navegaci√≥n -->
      <div class="wizard-nav">
        <button type="button" id="prevBtn" class="nav-btn" disabled>‚Üê Anterior</button>
        <button type="button" id="nextBtn" class="nav-btn primary">Siguiente ‚Üí</button>
      </div>
    {% else %}
      <div class="no-questions">
        <h3>üìö No hay preguntas disponibles</h3>
        <p>A√∫n no se han cargado preguntas de selecci√≥n en el sistema.</p>
        <p><a href="{% url 'upload_csv' %}" style="color: #667eea;">Cargar preguntas desde CSV</a></p>
      </div>
    {% endif %}
  </div>

  <script src="{% static 'questions/js/practice_exam.js' %}"></script>
</body>
</html>
